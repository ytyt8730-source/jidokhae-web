# Claude Code 서브에이전트 시스템 v2.5

> **버전**: 2.6 (초기세팅 업데이트)
> **총 에이전트**: 14개 (초기세팅 포함)
> **위치**: `.claude/agents/`

---

## 🎯 핵심 원칙 (컨텍스트 엔지니어링)

```
1. LLM = 판단만, 실행 = 스크립트
2. 컨텍스트 = 최소한만 전달
3. 복잡한 작업 = 쪼개서 위임
4. 결과만 받고, 과정은 버리기
5. 빈 깡통 전략 = 스크립트로 파일 구조 생성, 에이전트는 내용만
6. 배치 처리 = 한 번에 최대 20개 파일
7. 페이로드 회피 = 이미지/데이터는 파일로, 경로만 전달
```

---

## 📋 에이전트 목록

| # | 에이전트 | 역할 | 호출 시점 |
|:-:|----------|------|----------|
| 🎯 | **아키텍트** | 작업 분석, 실행 계획 | 복잡한 작업 전 |
| 0 | **초기세팅** | 새 프로젝트 세팅 | 프로젝트 시작 |
| 1 | **설계** | Milestone → WP 분해 | 마일스톤 시작 |
| 2 | **시나리오** | Phase별 SC 생성 | WP에 SC 없을 때 |
| 3 | **Git** | 브랜치/커밋/머지 | 코딩 전, Phase 후 |
| 4 | **코딩** | 코드 구현 | Phase 구현 |
| 5 | **테스트** | Scenario 검증 | 코딩 후 |
| 6 | **검사** | 타입/빌드/린트 | 테스트 후 |
| 7 | **수리** | 오류 해결 | 실패 시 |
| 8 | **기록** | WP 완료 로그 | WP 완료 후 |
| 9 | **학습** | 개념 설명, TIL | 궁금할 때 |
| 🧠 | **컨텍스트** | 프로젝트 현황 파악 | 새 대화, 파악 요청 |
| 🚀 | **파이프라인** | 마일스톤 자동 진행 | "M5 진행해", "끝까지" |

---

## 📜 자동화 스크립트 (토큰 0!)

| 스크립트 | 용도 | 대체하는 작업 |
|----------|------|--------------|
| `status.sh` | 빠른 상태 확인 | 상태 질문 |
| `start-coding.sh` | 코딩 전 체크 | 브랜치/상태 확인 |
| `check-all.sh` | 전체 검사 | **@agent-검사** |
| `pre-commit.sh` | 커밋 전 검사 | 민감정보 체크 |
| `find-pattern.sh` | 코드 패턴 검색 | 파일 전체 읽기 |
| `count-lines.sh` | 줄 수 체크 | 200줄 초과 탐지 |
| `gen-types.sh` | Supabase 타입 생성 | 타입 명령어 |
| `create-component.sh` | 컴포넌트 템플릿 | 보일러플레이트 |
| `scaffold-phase.sh` | 빈 깡통 생성 | Phase 파일 구조 미리 생성 |

### S급 품질 스크립트 (v2.5 신규)

| 스크립트 | 용도 | 사용 시점 |
|----------|------|----------|
| `quality-gate.sh` | S급 품질 검사 | Phase 커밋 전 |
| `pipeline-logger.sh` | 진행 상황 로깅 | Phase 전환 시 |
| `rollback.sh` | 자동 롤백 | 3회 연속 실패 시 |
| `test-api.sh` | API 엔드포인트 테스트 | 서버 실행 중일 때 |

**품질 게이트 검사 항목**:
```
□ 파일 200줄 초과 금지
□ console.log 금지
□ as any 금지
□ 미구현 TODO 경고
□ 접근성 속성 확인
```

### 스크립트 실행

```bash
# Windows (Git Bash)
bash scripts/status.sh
bash scripts/check-all.sh

# macOS/Linux
chmod +x scripts/*.sh  # 최초 1회
./scripts/status.sh
```

---

## 🔄 최적화된 워크플로우

### 스크립트 우선, 에이전트 나중!

```
┌─────────────────────────────────────────────┐
│  @agent-아키텍트 (복잡한 작업 시)            │
│    • 실행 계획 수립                         │
│    • 스크립트 vs 에이전트 결정              │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│  스크립트로 가능한 작업                      │
│  ────────────────────                       │
│  ./scripts/check-all.sh  (검사)             │
│  ./scripts/find-pattern.sh (패턴 검색)      │
│  ./scripts/count-lines.sh (줄 수 체크)      │
│  = 토큰 0개!                                │
└────────────────┬────────────────────────────┘
                 │
                 ▼
┌─────────────────────────────────────────────┐
│  에이전트가 필요한 작업                      │
│  ────────────────────                       │
│  @agent-코딩 (코드 작성)                    │
│  @agent-수리 (버그 분석)                    │
│  @agent-학습 (개념 설명)                    │
│  = 최소 컨텍스트만!                         │
└─────────────────────────────────────────────┘
```

---

## 💡 토큰 절약 팁

### 1. 검사는 스크립트로!

```bash
# ❌ 3000토큰 소모
"@agent-검사 검사해줘"

# ✅ 0토큰
./scripts/check-all.sh
```

### 2. 패턴 검색은 스크립트로!

```bash
# ❌ 파일 100개 읽기 = 대량 토큰
"모든 파일에서 console.log 찾아줘"

# ✅ 0토큰
./scripts/find-pattern.sh "console.log"
```

### 3. 복잡한 작업은 아키텍트에게!

```
# 먼저 계획 수립
@agent-아키텍트 M5 구현 계획 세워줘

# 계획대로 실행 (스크립트 + 에이전트 조합)
```

### 4. 질문은 구체적으로!

```
# ❌ 전체 파일 읽기
"코드 리뷰해줘"

# ✅ 해당 파일만
"src/app/admin/page.tsx 45번째 줄 에러 고쳐줘"
```

---

## 🎯 상황별 가이드

### 신규 기능 개발

```
1. @agent-아키텍트 실행 계획 세워줘
2. WP 확인 (파일 읽기)
3. git checkout -b feature/...
4. @agent-코딩 Phase N
5. ./scripts/check-all.sh  ← 스크립트!
6. git commit
7. (반복)
8. @agent-기록
```

### 버그 수정

```
1. ./scripts/find-pattern.sh로 관련 코드 찾기
2. @agent-수리 (해당 파일만)
3. ./scripts/check-all.sh
4. git commit
```

### 리팩토링

```
1. ./scripts/count-lines.sh로 대상 파일 식별
2. ./scripts/find-pattern.sh로 패턴 분석
3. @agent-코딩으로 리팩토링
4. ./scripts/check-all.sh
```

### 학습

```
@agent-학습 [개념] 설명해줘
→ 문서로 저장 (/docs/til/)
```

### 마일스톤 전체 자동화 (🆕 파이프라인)

```
# 마일스톤 자동 진행
@agent-파이프라인 M5 진행해

# 특정 Phase부터
@agent-파이프라인 M5 Phase 3부터 진행해

# 이어서 진행
@agent-파이프라인 M5 이어서 진행해
```

**파이프라인 워크플로우**:
```
1. 브랜치 생성 (feature/m[N]-implementation)
2. 빈 깡통 생성 (scaffold-phase.sh)
3. Phase별 코딩
4. 검사 (check-all.sh)
5. 커밋 & 푸시
6. → 다음 Phase 자동 진행
7. 마일스톤 완료 → PR 생성
```

---

## 🎯 모델 배정

| 에이전트 | 모델 | 이유 |
|---------|------|------|
| 컨텍스트 | haiku | 빠른 스캔, 토큰 절약 |
| 검사 | haiku | 단순 실행 |
| 학습 | inherit | 복잡한 설명 필요 |
| 코딩/수리 | sonnet | 고품질 코드 |
| 아키텍트 | sonnet | 복잡한 계획 |
| **파이프라인** | sonnet | 마일스톤 전체 자동화 |
| 기타 | (기본) | sonnet |

---

## 📊 예상 토큰 절약

| 작업 | Before | After | 절약 |
|------|--------|-------|------|
| 전체 검사 | 3000 | 0 | 100% |
| 패턴 검색 | 5000 | 0 | 100% |
| 줄 수 체크 | 2000 | 0 | 100% |
| Phase 코딩 | 8000 | 3000 | 63% |
| WP 전체 구현 | 50000 | 20000 | 60% |

**월간 예상: 70% 토큰 절약**

---

## 🔧 내장 에이전트 (Claude Code 기본 제공)

Claude Code에는 자동으로 사용되는 내장 에이전트가 있습니다:

| 이름 | 모델 | 용도 | 자동 호출 |
|------|------|------|----------|
| **Explore** | Haiku | 코드베이스 검색/탐색 | 코드 찾을 때 |
| **Plan** | 상속 | 계획 모드 연구 | `/plan` 사용 시 |
| **General-purpose** | 상속 | 복잡한 다단계 작업 | 자동 판단 |

→ 별도 호출 없이 Claude가 자동으로 사용합니다.
→ `@agent-컨텍스트`는 "현황 파악"에 특화, Explore는 "코드 검색"에 특화.

---

## 🆘 오랜만에 돌아왔을 때

```bash
# 1. 현재 상태 확인
./scripts/status.sh

# 2. 에이전트 사용법
cat .claude/agents/README.md

# 3. 최근 대화
"최근 대화 보여줘"

# 4. 모르는 개념
@agent-학습 [질문]
```

---

## 📁 파일 구조

```
/.claude/agents/
├── README.md          # 이 파일
├── 아키텍트.md        # 메타 에이전트
├── 초기세팅.md
├── 설계.md
├── 시나리오.md
├── Git.md
├── 코딩.md
├── 테스트.md
├── 검사.md
├── 수리.md
├── 기록.md
├── 학습.md
├── 컨텍스트.md        # 프로젝트 현황 파악
└── 파이프라인.md      # 🆕 마일스톤 자동화

/scripts/
├── status.sh
├── start-coding.sh
├── check-all.sh
├── pre-commit.sh
├── find-pattern.sh
├── count-lines.sh
├── gen-types.sh
├── create-component.sh
├── pack_context.py    # 전체 컨텍스트 패킹
├── context-diff.sh    # 변경분 컨텍스트
├── check-file-size.py # 파일 크기 검사 (Hook용)
├── scaffold-phase.sh  # 빈 깡통 생성
├── quality-gate.sh    # 🆕 S급 품질 게이트
├── pipeline-logger.sh # 🆕 파이프라인 로깅
├── rollback.sh        # 🆕 자동 롤백
└── test-api.sh        # 🆕 API 테스트

/prompts/              # 프롬프트 아카이브
├── README.md
├── coding/
│   └── implement-phase.md  # 🆕 Phase 구현 템플릿
├── testing/
│   └── verify-phase.md     # 🆕 Phase 검증 템플릿
├── refactoring/
└── documentation/

/docs/til/
├── 2026-01-21-서브에이전트-스크립트-가이드.md
└── 2026-01-21-에이전트-아키텍처-고도화.md
```

---

## 변경 이력

| 날짜 | 버전 | 변경 내용 |
|------|------|----------|
| 2026-01-22 | 2.5 | S급 품질 시스템: quality-gate.sh, pipeline-logger.sh, rollback.sh, test-api.sh, 프롬프트 자산 |
| 2026-01-22 | 2.4 | 파이프라인 에이전트 추가, 컨텍스트 엔지니어링 전략, scaffold-phase.sh, prompts 폴더 |
| 2026-01-22 | 2.3 | 컨텍스트 에이전트 추가, model 필드 최적화, hooks 도입, 내장 에이전트 안내 |
| 2026-01-21 | 2.2 | 아키텍트 에이전트 추가, 스크립트 4개 추가, 토큰 절약 가이드 |
| 2026-01-21 | 2.1 | 학습 에이전트 추가, 기본 스크립트 |
| 2026-01-20 | 2.0 | 워크플로우 전면 개편 |
